!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s="./node_modules/babel-loader/lib/index.js!./src/worker.js")}({"./node_modules/@babel/runtime/helpers/arrayWithHoles.js":function(e,t){e.exports=function(e){if(Array.isArray(e))return e}},"./node_modules/@babel/runtime/helpers/assertThisInitialized.js":function(e,t){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}},"./node_modules/@babel/runtime/helpers/classCallCheck.js":function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},"./node_modules/@babel/runtime/helpers/createClass.js":function(e,t){function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e.exports=function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}},"./node_modules/@babel/runtime/helpers/defineProperty.js":function(e,t){e.exports=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},"./node_modules/@babel/runtime/helpers/getPrototypeOf.js":function(e,t){function n(t){return e.exports=n=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},n(t)}e.exports=n},"./node_modules/@babel/runtime/helpers/inherits.js":function(e,t,n){var r=n("./node_modules/@babel/runtime/helpers/setPrototypeOf.js");e.exports=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&r(e,t)}},"./node_modules/@babel/runtime/helpers/iterableToArrayLimit.js":function(e,t){e.exports=function(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var s,a=e[Symbol.iterator]();!(r=(s=a.next()).done)&&(n.push(s.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{r||null==a.return||a.return()}finally{if(o)throw i}}return n}},"./node_modules/@babel/runtime/helpers/nonIterableRest.js":function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}},"./node_modules/@babel/runtime/helpers/possibleConstructorReturn.js":function(e,t,n){var r=n("./node_modules/@babel/runtime/helpers/typeof.js"),o=n("./node_modules/@babel/runtime/helpers/assertThisInitialized.js");e.exports=function(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?o(e):t}},"./node_modules/@babel/runtime/helpers/setPrototypeOf.js":function(e,t){function n(t,r){return e.exports=n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},n(t,r)}e.exports=n},"./node_modules/@babel/runtime/helpers/slicedToArray.js":function(e,t,n){var r=n("./node_modules/@babel/runtime/helpers/arrayWithHoles.js"),o=n("./node_modules/@babel/runtime/helpers/iterableToArrayLimit.js"),i=n("./node_modules/@babel/runtime/helpers/nonIterableRest.js");e.exports=function(e,t){return r(e)||o(e,t)||i()}},"./node_modules/@babel/runtime/helpers/typeof.js":function(e,t){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(t){return"function"==typeof Symbol&&"symbol"===n(Symbol.iterator)?e.exports=r=function(e){return n(e)}:e.exports=r=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":n(e)},r(t)}e.exports=r},"./node_modules/babel-loader/lib/index.js!./src/worker.js":function(e,t,n){"use strict";n.r(t);var r={BOARD_LENGTH:14,MAX_LENGTH:900,TREE_DENSITY:.15},o=220,i=2e6,s=500,a={NORTH:"N",SOUTH:"S",EAST:"E",WEST:"W"},u={N:[-1,0],S:[1,0],E:[0,1],W:[0,-1]},l={EMPTY:0,CHICKEN:1,FOX:2,TREE:3},c=n("./node_modules/@babel/runtime/helpers/classCallCheck.js"),h=n.n(c),f=n("./node_modules/@babel/runtime/helpers/createClass.js"),p=n.n(f),d=n("./node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),y=n.n(d),m=n("./node_modules/@babel/runtime/helpers/getPrototypeOf.js"),v=n.n(m),b=n("./node_modules/@babel/runtime/helpers/assertThisInitialized.js"),g=n.n(b),_=n("./node_modules/@babel/runtime/helpers/inherits.js"),T=n.n(_),E=n("./node_modules/@babel/runtime/helpers/defineProperty.js"),P=n.n(E),A=n("./node_modules/@babel/runtime/helpers/slicedToArray.js"),O=n.n(A),w=function(){function e(t,n){h()(this,e),P()(this,"type",void 0),P()(this,"sprite",void 0),P()(this,"position",void 0),P()(this,"gamesPlayed",void 0),P()(this,"hasValues",!1),P()(this,"getAvailableActions",function(e,t){var n=O()(t,2),o=n[0],i=n[1],s=[],u=r.BOARD_LENGTH-1,c=function(t,n){return e[t][n]!==l.TREE};return o>0&&c(o-1,i)&&s.push(a.NORTH),o<u&&c(o+1,i)&&s.push(a.SOUTH),i>0&&c(o,i-1)&&s.push(a.WEST),i<u&&c(o,i+1)&&s.push(a.EAST),s}),this.type=n,this.sprite=t,this.gamesPlayed=0,this.position=[0,0]}return p()(e,[{key:"onTimestep",value:function(e,t){return null}},{key:"onGameEnd",value:function(){this.gamesPlayed++}},{key:"serialize",value:function(){return{type:this.type,data:{gamesPlayed:this.gamesPlayed}}}},{key:"deserialize",value:function(e){return this.gamesPlayed=e.data.gamesPlayed,this}},{key:"getValues",value:function(e){return null}}],[{key:"getManhattanDistance",value:function(e,t){return Math.abs(e[0]-t[0])+Math.abs(e[1]-t[1])}},{key:"getNewPosition",value:function(e,t){if(!e)return t;var n=u[e];return[t[0]+n[0],t[1]+n[1]]}},{key:"getActionFromPositions",value:function(e,t){return t[0]===e[0]+1&&t[1]===e[1]?a.SOUTH:t[0]===e[0]-1&&t[1]===e[1]?a.NORTH:t[0]===e[0]&&t[1]===e[1]+1?a.EAST:t[0]===e[0]&&t[1]===e[1]-1?a.WEST:null}},{key:"samePosition",value:function(e,t){return e[0]==t[0]&&e[1]==t[1]}}]),e}(),S={ArrowDown:"S",ArrowUp:"N",ArrowLeft:"W",ArrowRight:"E",s:"S",w:"N",a:"W",d:"E"},N=function(e){function t(e,n){var r;return h()(this,t),r=y()(this,v()(t).call(this,e,n)),P()(g()(r),"chosenNextAction",void 0),P()(g()(r),"onKeyDown",function(e){r.chosenNextAction=S[e.key]||null}),r.chosenNextAction=null,document.addEventListener("keydown",r.onKeyDown),r}return T()(t,e),p()(t,[{key:"onTimestep",value:function(e,t){var n=null;return this.getAvailableActions(e,this.position).includes(this.chosenNextAction)&&(n=this.chosenNextAction,this.chosenNextAction=null),n}}]),t}(w);function R(e){var t,n,r;for(r=e.length-1;r>0;r--)t=Math.floor(Math.random()*(r+1)),n=e[r],e[r]=e[t],e[t]=n;return e}function j(e){return e[Math.floor(Math.random()*e.length)]}a.SOUTH,a.NORTH,a.WEST,a.EAST;var I=function(e){function t(e,n){var r;return h()(this,t),r=y()(this,v()(t).call(this,e,n)),P()(g()(r),"isFollowing",void 0),r.isFollowing=e===l.FOX,r}return T()(t,e),p()(t,[{key:"onTimestep",value:function(e,t){var n=this.getAvailableActions(e,this.position),r=O()(this.position,2),o=r[0],i=r[1],s=O()(t,2),u=s[0],l=s[1],c=this.isFollowing?o>u:o<=u,h=this.isFollowing?o<u:o>=u,f=this.isFollowing?i<l:i>=l,p=[];return(this.isFollowing?i>l:i<=l)&&n.includes(a.WEST)&&p.push(a.WEST),f&&n.includes(a.EAST)&&p.push(a.EAST),c&&n.includes(a.NORTH)&&p.push(a.NORTH),h&&n.includes(a.SOUTH)&&p.push(a.SOUTH),p.length<1?j(n):j(p)}}]),t}(w),x=function(e){function t(){return h()(this,t),y()(this,v()(t).apply(this,arguments))}return T()(t,e),p()(t,[{key:"onTimestep",value:function(e,t){return j(this.getAvailableActions(e,this.position))}}]),t}(w),H=function(e){function t(e,n){var o;h()(this,t),o=y()(this,v()(t).call(this,e,n)),P()(g()(o),"squares",void 0),o.squares={};for(var i=0;i<r.BOARD_LENGTH;i++)for(var s=0;s<r.BOARD_LENGTH;s++)o.squares[M([i,s])]={steps:0,score:0};return o}return T()(t,e),p()(t,[{key:"onTimestep",value:function(e,t){var n=0,r=new Set,o=new Set,i=M(this.position),s=M(t);for(this.squares[i].steps=0,this.squares[i].score=w.getManhattanDistance(this.position,t);i!==s;){o.add(i),r.delete(i);var a=D(i),u=this.getAvailableActions(e,a),l=!0,c=!1,h=void 0;try{for(var f,p=R(u)[Symbol.iterator]();!(l=(f=p.next()).done);l=!0){var d=f.value,y=w.getNewPosition(d,a),m=M(y);o.has(m)||(this.squares[m].steps=this.squares[i].steps+1,this.squares[m].score=this.squares[m].steps+w.getManhattanDistance(y,t),r.add(m))}}catch(e){c=!0,h=e}finally{try{l||null==p.return||p.return()}finally{if(c)throw h}}if(r.size<1)return null;var v=null,b=Number.POSITIVE_INFINITY,g=!0,_=!1,T=void 0;try{for(var E,P=r[Symbol.iterator]();!(g=(E=P.next()).done);g=!0){var A=E.value;this.squares[A].score<b&&(v=A,b=this.squares[A].score)}}catch(e){_=!0,T=e}finally{try{g||null==P.return||P.return()}finally{if(_)throw T}}if(i=v||i,++n>5e3)return null}for(;this.squares[i].steps>1;){var O=null,S=Number.POSITIVE_INFINITY,N=!0,j=!1,I=void 0;try{for(var x,H=o[Symbol.iterator]();!(N=(x=H.next()).done);N=!0){var F=x.value;1===w.getManhattanDistance(D(i),D(F))&&this.squares[F].steps<S&&(O=F,S=this.squares[F].steps)}}catch(e){j=!0,I=e}finally{try{N||null==H.return||H.return()}finally{if(j)throw I}}if(!O)break;i=O}return i?w.getActionFromPositions(this.position,D(i)):null}}]),t}(w),M=function(e){return 100*e[0]+e[1]},D=function(e){return[(e-e%100)/100,e%100]},F=function(){function e(t){var n=this;h()(this,e),P()(this,"_states",void 0),P()(this,"getKeyFromPositions",function(e,t){return n.getKey(e[0],e[1],t[0],t[1])}),this._states={};for(var o=0;o<r.BOARD_LENGTH;o++)for(var i=0;i<r.BOARD_LENGTH;i++)for(var s=0;s<r.BOARD_LENGTH;s++)for(var a=0;a<r.BOARD_LENGTH;a++)this._states[this.getKey(o,i,s,a)]=t()}return p()(e,[{key:"getState",value:function(e){return this._states[e]}},{key:"getStateFromPositions",value:function(e,t){return this.getState(this.getKeyFromPositions(e,t))}},{key:"getKey",value:function(e,t,n,r){return 1e6*e+1e4*t+100*n+r}}]),e}(),k=function(e){function t(e,n){var r;h()(this,t),r=y()(this,v()(t).call(this,e,n)),P()(g()(r),"isFleeing",void 0),P()(g()(r),"states",void 0),P()(g()(r),"hasValues",!0),r.isFleeing=e===l.CHICKEN;return r.states=new F(function(){return{value:.1*Math.random()}}),r}return T()(t,e),p()(t,[{key:"onTimestep",value:function(e,t){var n=this.getAvailableActions(e,this.position);n.push(null);var r,o=1/Math.sqrt(this.gamesPlayed);r=Math.random()<o?this.chooseActionRandomly(n):this.chooseActionGreedily(n,this.position,t);var i=w.getNewPosition(r,this.position),s=w.getManhattanDistance(this.position,t),a=this.getReward(s),u=this.states.getStateFromPositions(this.position,t).value,l=u+.99*(a+.99*this.states.getStateFromPositions(i,t).value-u);return this.states.getStateFromPositions(this.position,t).value=l,r}},{key:"serialize",value:function(){return{type:this.type,data:{gamesPlayed:this.gamesPlayed,stateSpace:this.states._states}}}},{key:"deserialize",value:function(e){this.gamesPlayed=e.data.gamesPlayed;var t=e.data.stateSpace;return t&&(this.states._states=t),this}},{key:"getValues",value:function(e){for(var t=[],n=[],o=0;o<r.BOARD_LENGTH;o++)for(var i=0;i<r.BOARD_LENGTH;i++){t[o]||(t[o]=[]);var s=this.states.getKey(o,i,e[0],e[1]),a=this.states.getState(s).value;t[o].push(a),n.push(a)}n.sort(function(e,t){return e-t});for(var u=0;u<r.BOARD_LENGTH;u++)for(var l=0;l<r.BOARD_LENGTH;l++)t[u][l]=n.indexOf(t[u][l])/(n.length-1);return t}},{key:"getReward",value:function(e){return this.isFleeing?1==e?-10:0:1==e?10:0}},{key:"chooseActionRandomly",value:function(e){return j(e)}},{key:"chooseActionGreedily",value:function(e,t,n){var r=null,o=Number.NEGATIVE_INFINITY,i=!0,s=!1,a=void 0;try{for(var u,l=e[Symbol.iterator]();!(i=(u=l.next()).done);i=!0){var c=u.value,h=void 0;h=c?w.getNewPosition(c,t):t;var f=this.states.getStateFromPositions(h,n).value;f>o&&(o=f,r=c,h)}}catch(e){s=!0,a=e}finally{try{i||null==l.return||l.return()}finally{if(s)throw a}}return r}}]),t}(w),C=function(e){switch(e){case"CHICKEN_TEMPORAL_DIFFERENCE":return new k(l.CHICKEN,e);case"FOX_TEMPORAL_DIFFERENCE":return new k(l.FOX,e);case"CHICKEN_RANDOM":return new x(l.CHICKEN,e);case"FOX_RANDOM":return new x(l.FOX,e);case"FOX_GREEDY":return new I(l.FOX,e);case"CHICKEN_GREEDY":return new I(l.CHICKEN,e);case"CHICKEN_PLAYER":return new N(l.CHICKEN,e);case"FOX_PLAYER":return new N(l.FOX,e);case"FOX_A_STAR":return new H(l.FOX,e);default:throw Error("Actor type ".concat(e," not recognized"))}},G=!1,L=function e(t,n,r){var i=this;h()(this,e),P()(this,"grid",void 0),P()(this,"actors",void 0),P()(this,"gameIterations",void 0),P()(this,"timerId",void 0),P()(this,"worker",void 0),P()(this,"valuesDisplay",null),P()(this,"runGame",function(){i.timerId=setInterval(i.runGameTimestep,o)}),P()(this,"runGameTimestep",function(){var e=K(i.actors[0].position,i.actors[1].position)<2,t=i.gameIterations>=s;if(e||t){i.gameIterations=0;var n=!0,r=!1,o=void 0;try{for(var a,u=i.actors[Symbol.iterator]();!(n=(a=u.next()).done);n=!0){var l=a.value;e&&l.onGameEnd(),i._clearPosition(l.position),l.position=i._getRandomPosition(),i._setPosition(l)}}catch(e){r=!0,o=e}finally{try{n||null==u.return||u.return()}finally{if(r)throw o}}}i.gameIterations++;var c=null,h=!0,f=!1,p=void 0;try{for(var d,y=i.actors.entries()[Symbol.iterator]();!(h=(d=y.next()).done);h=!0){var m=O()(d.value,2),v=(m[0],m[1]),b=c||i.actors[1].position,g=v.onTimestep(i.grid,b);c=v.position,i._move(v,g)}}catch(e){f=!0,p=e}finally{try{h||null==y.return||y.return()}finally{if(f)throw p}}}),P()(this,"newGame",function(){i.gameIterations=0;var e=!0,t=!1,n=void 0;try{for(var r,o=i.actors[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value;i._clearPosition(s.position),s.position=i._getRandomPosition(),i._setPosition(s)}}catch(e){t=!0,n=e}finally{try{e||null==o.return||o.return()}finally{if(t)throw n}}}),P()(this,"getCanTrain",function(){return i.actors.some(function(e){return e.hasValues})}),P()(this,"getGamesPlayed",function(){return i.actors.map(function(e){return e.gamesPlayed})}),P()(this,"trainActors",function(e,t){if(!G){G=!0,i.worker.onmessage=function(n){var r=n.data,o=r.isTrainingDone,s=r.trainingProgress,a=r.actorMessages;o&&a?(i.actors=a.map(function(e,t){return i.actors[t].deserialize(e)}),G=!1,t()):e(s)};var n={actorMessages:i.actors.map(function(e){return e.serialize()}),grid:i.grid};i.worker.postMessage(n)}}),P()(this,"selectActor",function(e,t){var n=i.actors[e];if(t===n.type)return!1;i._clearPosition(n.position);var r=C(t);return i.actors[e]=r,r.position=i._getRandomPosition(),i._setPosition(r),!0}),P()(this,"resetActor",function(e){var t=i.actors[e],n=C(t.type);n.position=t.position,i.actors[e]=n}),P()(this,"toggleValueDisplay",function(e){i.valuesDisplay&&(i.valuesDisplay=null),i.actors[e].hasValues&&e!==i.valuesDisplay&&(i.valuesDisplay=e)}),P()(this,"_move",function(e,t){t&&(i._clearPosition(e.position),e.position[0]+=u[t][0],e.position[1]+=u[t][1],i._setPosition(e))}),P()(this,"_getRandomPosition",function(){for(var e=[0,0];e=[q(),q()],i.grid[e[0]][e[1]]!==l.EMPTY;);return e}),P()(this,"_setPosition",function(e){i.grid[e.position[0]][e.position[1]]=e.sprite}),P()(this,"_clearPosition",function(e){i.grid[e[0]][e[1]]=l.EMPTY}),this.worker=r,this.grid=t,this.gameIterations=0,this.actors=n;var a=!0,c=!1,f=void 0;try{for(var p,d=this.actors[Symbol.iterator]();!(a=(p=d.next()).done);a=!0){var y=p.value,m=this._getRandomPosition();y.position=m,this._setPosition(y)}}catch(e){c=!0,f=e}finally{try{a||null==d.return||d.return()}finally{if(c)throw f}}},K=function(e,t){return Math.abs(e[0]-t[0])+Math.abs(e[1]-t[1])},q=function(){return Math.floor(Math.random()*r.BOARD_LENGTH)},z=!1,B=i/100;onmessage=function(e){if(!z){z=!0;for(var t=e.data,n=t.actorMessages,r=t.grid,o=n.map(function(e){return C(e.type).deserialize(e)}),s=new L(r,o),a=0;a<i;a++)s.runGameTimestep(),a%B==0&&postMessage({isTrainingDone:!1,trainingProgress:Math.floor(100*a/i)});postMessage({isTrainingDone:!0,trainingProgress:100,actorMessages:o.map(function(e){return e.serialize()})}),z=!1}}}});